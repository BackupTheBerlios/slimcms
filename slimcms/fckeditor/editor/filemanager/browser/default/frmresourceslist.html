<!--
 * FCKeditor - The text editor for internet
 * Copyright (C) 2003-2004 Frederico Caldeira Knabben
 *
 * Licensed under the terms of the GNU Lesser General Public License:
 *                 http://www.opensource.org/licenses/lgpl-license.php
 *
 * For further information visit:
 *                 http://www.fckeditor.net/
 *
 * File Name: frmresourceslist.html
 *         This page shows all resources available in a folder in the File Browser.
 *
 * Version:  2.0 Beta 2
 * Modified: 2004-06-19 01:01:50
 *
 * File Authors:
 *                 Frederico Caldeira Knabben (fredck@fckeditor.net)
-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
        <head>
                <meta name="vs_targetSchema" content="http://schemas.microsoft.com/intellisense/ie5">
                <link href="Browser.css" type="text/css" rel="stylesheet">
                <script type="text/javascript" src="js/fckxml.js"></script>
                <script type="text/javascript" src="js/common.js"></script>
                <script language="javascript">

var oListManager = new Object() ;

oListManager.Init = function()
{
        this.Table = document.getElementById('tableFiles') ;
}

oListManager.Clear = function()
{
        // Remove all other rows available.
        while ( this.Table.rows.length > 0 )
                this.Table.deleteRow(0) ;
}

oListManager.AddFolder = function( folderName, folderPath )
{
        var docWidth=document.width;
        var maxCols=docWidth/100;
        maxCols--;

        var rows=this.Table.getElementsByTagName('tr');


        if (rows.length!=0) {
                var lastRow = rows[(rows.length-1)];
                var cells = lastRow.getElementsByTagName('td');
                var lastRow_Cols = cells.length;

                if (lastRow_Cols>=maxCols) {
                        lastRow = this.Table.insertRow(-1);
                }
        } else {
                var lastRow = this.Table.insertRow(-1);
        }

        // Build the link to view the folder.
        var sLink = '<a href="#" onclick="OpenFolder(\'' + folderPath + '\');return false;">' ;
        var dLink = '<a href="#" onclick="DeleteFolder(\'' + folderName + '\');return false;">' ;

        // Add the file icon cell.
        var oCell = lastRow.insertCell(-1) ;
        oCell.width = 96 ;
        oCell.innerHTML = sLink + '<img alt="" src="images/Folder96.jpg" width="96" height="96" border="0"><br />' + folderName + '</a><br />&nbsp;<br />[' + dLink + 'delete</a>]' ;
        oCell.noWrap = true ;
        oCell.align = 'center' ;

}

oListManager.AddFile = function ( fileName, fileUrl, fileSize )
{
        var docWidth=document.width;
        var maxCols=docWidth/100;
        maxCols--;

        var rows=this.Table.getElementsByTagName('tr');


        if (rows.length!=0) {
                var lastRow = rows[(rows.length-1)];
                var cells = lastRow.getElementsByTagName('td');
                var lastRow_Cols = cells.length;

                if (lastRow_Cols>=maxCols) {
                        var lastRow = this.Table.insertRow(-1);
                }
        } else {
                var lastRow = this.Table.insertRow(-1);
        }

        // Build the link to view the folder.
        var sLink = '<a href="#" onclick="OpenFile(\'' + fileUrl + '\');return false;">' ;

        // Add the file icon cell.
        var oCell = lastRow.insertCell(-1) ;
        oCell.width = 96 ;
        oCell.innerHTML = sLink +
                '<img alt="" src="' +
                                        oConnector.ConnectorUrl +
                                        '?Command=Thumbnail&Type=' +
                                        GetUrlParam( 'Type' ) +
                                        '&CurrentFolder=' +
                                        oConnector.CurrentFolder +
                                        '&FileName=' + fileName +
                                        '" width="96" height="96" border="0"><br />' +
                fileName + '<br />' +
                fileSize + 'KB</a><br />' +
                '[<a href="#" onclick="DeleteFile(\'' + fileName + '\',\'' + fileUrl + '\');return false;">delete</a>]&nbsp;<br />&nbsp;' ;
        oCell.noWrap = true ;
        oCell.align = 'center' ;

}

oListManager.PackRow = function ()
{
        var docWidth=document.width;
        var maxCols=docWidth/100;
        maxCols--;

        var rows=this.Table.getElementsByTagName('tr');


        if (rows.length!=0) {
                var lastRow = rows[(rows.length-1)];
                var cells = lastRow.getElementsByTagName('td');
                var lastRow_Cols = cells.length;

                if (lastRow_Cols<maxCols) {
                        for (i=lastRow_Cols;i<maxCols;i++) {
                                var oCell = lastRow.insertCell(-1);
                                oCell.width=96;
                                oCell.innerHTML = '&nbsp;';
                                oCell.noWrap=true;
                                oCell.align='center';
                        }
                }
        }

}

function OpenFolder( folderPath )
{
        // Load the resources list for this folder.
        window.parent.frames['frmFolders'].LoadFolders( folderPath ) ;
}

function OpenFile( fileUrl )
{
        window.top.opener.SetUrl( fileUrl ) ;
        window.top.close() ;
        window.top.opener.focus() ;
}

function DeleteFile( fileName, fileUrl )
{
        if (confirm('Are you sure you wish to delete ' + fileName + '?')) {
                oConnector.SendCommand( 'DeleteFile', "FileName=" + escape( fileName ), DeleteFileCallBack ) ;
        }
}

function DeleteFolder( folderName )
{
        if (confirm('Are you sure you wish to delete ' + folderName + ' and all files in it?')) {
                oConnector.SendCommand( 'DeleteFolder', "FolderName=" + escape( folderName ), DeleteFolderCallBack ) ;
        }
}

function LoadResources( resourceType, folderPath )
{
        oListManager.Clear() ;
        oConnector.ResourceType = resourceType ;
        oConnector.CurrentFolder = folderPath
        oConnector.SendCommand( 'GetFoldersAndFiles', null, GetFoldersAndFilesCallBack ) ;
}

function Refresh()
{
        LoadResources( oConnector.ResourceType, oConnector.CurrentFolder ) ;
}

function GetFoldersAndFilesCallBack( fckXml )
{
        // Get the current folder path.
        var oNode = fckXml.SelectSingleNode( 'Connector/CurrentFolder' ) ;
        var sCurrentFolderPath        = oNode.attributes.getNamedItem('path').value ;
        var sCurrentFolderUrl        = oNode.attributes.getNamedItem('url').value ;

        // Add the Folders.
        var oNodes = fckXml.SelectNodes( 'Connector/Folders/Folder' ) ;
        for ( var i = 0 ; i < oNodes.length ; i++ )
        {
                var sFolderName = oNodes[i].attributes.getNamedItem('name').value ;
                oListManager.AddFolder( sFolderName, sCurrentFolderPath + sFolderName + "/" ) ;
        }

        // Add the Files.
        var oNodes = fckXml.SelectNodes( 'Connector/Files/File' ) ;
        for ( var i = 0 ; i < oNodes.length ; i++ )
        {
                var sFileName = oNodes[i].attributes.getNamedItem('name').value ;
                var sFileSize = oNodes[i].attributes.getNamedItem('size').value ;
                oListManager.AddFile( sFileName, sCurrentFolderUrl + sFileName, sFileSize ) ;
        }

        oListManager.PackRow();
}

function DeleteFileCallBack ( fckXml )
{
        var oNodes = fckXml.SelectNodes( 'Connector/Error' );
        if (oNodes.length>0) {
                var errNo = parseInt(oNodes[0].attributes.getNamedItem('number').value) ;

                switch (errNo) {
                        case 0 :
                                break;

                        case 202 :
                                alert('Failed to delete file.');
                                break;

                        default:
                                alert('Invalid XML response from connector..');
                }
        } else {
                alert('Invalid XML response from connector.');
        }
        Refresh();
}


function DeleteFolderCallBack ( fckXml )
{
        var oNodes = fckXml.SelectNodes( 'Connector/Error' );
        if (oNodes.length>0) {
                var errNo = parseInt(oNodes[0].attributes.getNamedItem('number').value) ;

                switch (errNo) {
                        case 0 :
                                break;

                        case 202 :
                                alert('Failed to delete folder.');
                                break;

                        default:
                                alert('Invalid XML response from connector..');
                }
        } else {
                alert('Invalid XML response from connector.');
        }
        Refresh();
}


window.onload = function()
{
        oListManager.Init() ;
        window.top.IsLoadedResourcesList = true ;
}
                </script>

        </head>
        <body class="FileArea" bottomMargin="10" leftMargin="10" topMargin="10" rightMargin="10">
                <table id="tableFiles" cellSpacing="1" cellPadding="0" width="100%" border="0">
                </table>
        </body>
</html>